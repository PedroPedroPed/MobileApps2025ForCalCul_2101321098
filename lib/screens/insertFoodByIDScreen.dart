import 'package:flutter/material.dart';import '../services/meservice.dart';import '../models/userDto.dart';import '../models/getInfoFoodsDTO.dart';import '../services/userFoods.dart';import '../services/food.dart';import '../screens/insertFoodScreen.dart';import '../models/foodDTO.dart';class InsertFoodByIDScreen extends StatefulWidget {  final String? token;  final int? food_id;  const InsertFoodByIDScreen({super.key, this.token, this.food_id});  @override  State<InsertFoodByIDScreen> createState() => _InsertFoodByIDScreenState();}class _InsertFoodByIDScreenState extends State<InsertFoodByIDScreen> {  final TextEditingController _calController = TextEditingController();  late Future<FoodDTO> foodFuture;  @override  void initState() {    super.initState();    foodFuture = getFoodById(widget.token!, widget.food_id.toString());    _calController.addListener(() {      setState(() {});    });  }  @override  Widget build(BuildContext context) {    double parseGram = 0;    if (_calController.text.isNotEmpty) {      try {        parseGram = double.parse(_calController.text);      } catch (e) {        parseGram = 0;      }    }    return Scaffold(      appBar: AppBar(        backgroundColor: Colors.green,        foregroundColor: Colors.white,        title: const Center(child: Text("CalCul")),      ),      body: FutureBuilder<FoodDTO>(        future: foodFuture,        builder: (context, snapshot) {          if (snapshot.connectionState == ConnectionState.waiting) {            return const Center(child: CircularProgressIndicator());          } else if (snapshot.hasError) {            return Center(child: Text("Error: ${snapshot.error}"));          } else if (!snapshot.hasData) {            return const Center(child: Text("No data"));          } else {            final food = snapshot.data!;            return Column(              children: [                Text("Name: ${food.name}"),                Text("Protein: ${food.protein}"),                Text("Fat: ${food.fat}"),                Text("Carbohydrates: ${food.carbohydrates}"),                TextField(                  controller: _calController,                  decoration: const InputDecoration(                    hintText: "Enter grams",                  ),                  keyboardType: TextInputType.number,                ),                Text("Protein: ${parseGram * (food.protein / 100)}"),                Text("Fat: ${parseGram * (food.fat / 100)}"),                Text("Carbohydrates: ${parseGram * (food.carbohydrates / 100)}"),                ElevatedButton(                  onPressed: () async {                   String res = await InsertFood(                      widget.food_id.toString(),                      _calController.text,                      widget.token!,                    );                  if(res == "ok"){                  ScaffoldMessenger.of(context).showSnackBar(                    SnackBar(content: Text("Insert ${parseGram}g ${food.name}")),                  );                  } else {                    ScaffoldMessenger.of(context).showSnackBar(                      SnackBar(content: Text("Error")),                    );                   }                  },                  child: const Text("Insert"),                ),              ],            );          }        },      ),    );  }}